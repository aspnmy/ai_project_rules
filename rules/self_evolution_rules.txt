# 自我进化规则次级规则文件
# 版本: 1.0
# 创建日期: 2024年
# 描述: 定义自我进化系统的规则和优先级规范

## 高优先级规则（必须严格遵守）

### 1. 模式优先级规则
- PG_ProjectMod为devP时，自我进化优先级高于人工编辑
- PG_ProjectMod为proD时，自我进化优先级低于人工编辑
- 必须在每次操作前检查当前项目模式

### 2. 文件锁定机制
- 执行自我进化操作前必须获取文件锁
- 锁文件必须包含锁定时间和进程ID信息
- 锁文件超过5分钟视为过期并可强制删除
- 完成操作后必须释放文件锁

### 3. 冲突日志记录
- 所有路径冲突必须记录到Logs/path_conflicts.log
- 日志必须包含时间戳、文件路径、模式、冲突原因和解决方式
- 冲突日志必须定期清理，避免文件过大

### 4. 待办文件格式
- 自我进化待办文件格式：文件路径|优先级|添加时间
- 优先级标记必须为HIGH或LOW
- devP模式下优先级为HIGH
- proD模式下优先级为LOW

### 5. 用户活动检测
- 必须通过.trae/.user_activity文件检测用户活动状态
- 用户活动文件超过5分钟未更新视为用户不活动

## 中优先级规则（建议遵守）

### 6. 监控间隔设置
- 常规监控间隔建议为60秒
- 高频率开发环境可调整为30秒
- 生产环境建议调整为300秒

### 7. 线程安全机制
- 所有共享资源访问必须使用锁保护
- 自我进化操作必须在独立线程中执行
- 主进程必须能够安全停止监控线程

### 8. 错误处理策略
- 单个文件处理失败不应影响其他文件处理
- 错误必须记录详细的异常信息
- 关键错误必须通过日志系统记录

### 9. 日志级别控制
- 生产环境建议使用INFO级别日志
- 开发环境可使用DEBUG级别日志
- 错误和警告必须始终记录

### 10. 路径处理规范
- 所有路径必须使用Path对象处理
- 路径比较必须使用规范化路径
- 相对路径必须基于项目根目录解析

## 低优先级规则（优化建议）

### 11. 性能优化建议
- 批量处理文件变化以减少I/O操作
- 使用高效的哈希算法计算文件内容变化
- 定期清理哈希缓存以释放内存

### 12. 用户体验优化
- 提供清晰的监控状态指示
- 支持单次执行和持续监控两种模式
- 提供优雅的停止机制

### 13. 可维护性建议
- 代码必须包含完整的注释文档
- 函数必须明确参数类型和返回值
- 使用类型提示提高代码可读性

### 14. 可扩展性建议
- 设计模块化结构以支持未来功能扩展
- 提供插件机制允许自定义规则处理
- 使用配置文件管理系统参数

### 15. 安全建议
- 避免直接执行未知来源的代码
- 验证文件权限后再进行写操作
- 防止路径遍历攻击